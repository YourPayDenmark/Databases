USE di_payments;

CREATE TABLE `02_rebilling_stl` (
  `subscription_id` varchar(16) NOT NULL,
  `parent_transaction` varchar(50) NOT NULL,
  `last_verified` bigint(12) NOT NULL,
  `last_requested` bigint(12) NOT NULL,
  `directory_id` varchar(255) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

ALTER TABLE `02_rebilling_stl`
  ADD UNIQUE KEY `subscription_id` (`subscription_id`);

INSERT INTO `payon_transid_operationid` (`creationtime`, `token`, `transid`, `operation_id`, `operation_type`, `request`, `response`) VALUES
('2021-06-22 08:39:54', 'Uk8Pdy1vUvICjqLu3KdmRAez7L5HNd8z.ntjr9ylT1YE', 2005165368, '3DS20210622103952173187', 'THREED', '{\"3ds_acquirer_bin\":\"529786\",\"3ds_acquirer_mid\":\"000104960044515\",\"3ds_acquirer_password\":\"\",\"3ds_addrmatch\":\"true\",\"3ds_browseracceptheader\":\"text\\/html, application\\/xhtml+xml, application\\/xml; q=0.9, image\\/webp, image\\/apng, *\\/*; q=0.8\",\"3ds_browsercolordepth\":\"24\",\"3ds_browserjavaenabled\":\"true\",\"3ds_browserscreenheight\":\"1080\",\"3ds_browserscreenwidth\":\"1920\",\"3ds_browsertz\":\"-60\",\"3ds_challengewindowsize\":\"05\",\"3ds_channel\":\"02\",\"3ds_initiate\":\"01\",\"3ds_merchant_country\":\"208\",\"3ds_merchant_mcc\":\"5039\",\"3ds_merchant_name\":\"Yourpay*Yourpay\",\"3ds_merchant_url\":\"https:\\/\\/www.yourpay.io\",\"3ds_purchasedate\":\"20210622103952\",\"3ds_redirect_url\":\"https:\\/\\/webservice.yourpay.io\\/v4.3\\/payment_auth_threed?token=Uk8Pdy1vUvICjqLu3KdmRAez7L5HNd8z.ntjr9ylT1YE&complete=1\",\"3ds_requestorid\":\"CRE51138229186599999999\",\"3ds_requestorname\":\"Yourpay\",\"3ds_shipindicator\":\"01\",\"3ds_transtype\":\"01\",\"M\":\"10023178\",\"O\":\"98\",\"a1\":\"60004772CRD20210622103952173278\",\"a4\":\"100\",\"a5\":\"DKK\",\"b1\":\"5156219004199193\",\"b3\":\"05\",\"b4\":\"24\",\"b5\":\"444\",\"c1\":\"Cardholder\",\"c3\":\"support@yourpay.io\",\"d1\":\"127.0.0.1\",\"d5\":\"Mozilla\\/5.0 Windows NT 10.0 AppleWebKit\\/537.36 KHTML, like Gecko Chrome\\/89.0.4389.114 Safari\\/537.36\",\"d6\":\"en-GB\",\"h3\":\"229186599999999\",\"K\":\"626764f99311656fb75f01b2842a59c00878a92a9bf1b1abaf27cb92e5d37c33\"}', '[\"3ds_acsurl=https%3A%2F%2Fx3d-redirect.credorax.net%2Fchallenge%2Frequest%2F10023178%2F8a20672a02b2804c8708a4e0f96221b4a576\",\"3ds_dstrxid=62c3f9cd-60b3-4d91-9cc2-744de30f6152\",\"3ds_status=C\",\"3ds_trxid=f071c2eb-b899-42af-8acf-6b65d7bdfbc8\",\"3ds_version=2.1.0\",\"K=5d638b661510416e9801daa130642f7403bcd68e74686d50558d91c10d8cd2ca\",\"M=10023178\",\"O=98\",\"T=06%2F22%2F2021+08%3A39%3A52\",\"a1=60004772CRD20210622103952173278\",\"a2=2\",\"a4=100\",\"a9=6\",\"b1=515621...9193\",\"b2=2\",\"b3=05\",\"b4=24\",\"c1=Cardholder\",\"h3=229186599999999\",\"z1=XZZ664277c682fe730956DMDJ6WINHP5\",\"z2=06\",\"z3=Transaction+pending+cardholder+authentication.\",\"z55=XZZ664277c682fe7309G3HAITO4BBCNL\"]'),
('2021-06-22 08:39:54', 'Uk8Pdy1vUvICjqLu3KdmRAez7L5HNd8z.ntjr9ylT1YE', 2005165368, 'PRES1624351194812-ZwyNwIq2gSDA', 'PAYMENT_RESPONSE', '', '{\"status\":\"WAIT\",\"threedsecure\":{\"enrolled\":\"Y\",\"acsurl\":\"https:\\/\\/x3d-redirect.credorax.net\\/challenge\\/request\\/10023178\\/8a20672a02b2804c8708a4e0f96221b4a576\",\"method\":\"\",\"pareq\":\"f071c2eb-b899-42af-8acf-6b65d7bdfbc8\",\"z1\":\"XZZ664277c682fe730956DMDJ6WINHP5\",\"ds_method\":null,\"ds_trxid\":\"f071c2eb-b899-42af-8acf-6b65d7bdfbc8\",\"trxid\":\"62c3f9cd-60b3-4d91-9cc2-744de30f6152\",\"ds_version\":\"2.1.0\",\"3ds_state\":\"Transaction+pending+cardholder+authentication.\",\"wallet_uri\":\"https:\\/\\/3ds.yourpay.io\\/\\/wallet?d=3DS20210622103952173187\"}}'),
('2021-06-22 08:41:18', 'Uk8Pdy1vUvICjqLu3KdmRAez7L5HNd8z.ntjr9ylT1YE', 2005165368, 'PRES1624351278226-0zSiFEOGP58Z', 'PAYMENT_RESPONSE', '', '{\"status\":\"ACK\",\"method\":\"STL\",\"PaymentID\":2005165368,\"tid\":3947467,\"cardno\":\"515621XXXXXX9193\",\"orderid\":\"CCRG\",\"ccrg\":\"6640.9366.6531\",\"amount\":\"100\",\"time\":1624351278,\"chained\":0,\"chained2\":0,\"sca\":\"\",\"token\":\"\",\"accepturl\":\"https:\\/\\/www.yourpay.io?uxtime=1624351278&MerchantNumber=60004772&tid=3947467&tchecksum=0551efa2b4c16049a663a914a152feae80296d57&checksum=0551efa2b4c16049a663a914a152feae80296d57&orderid=CCRG&ShopPlatform=Own&amount=100&split=0&date=20210622&cvc=&expmonth=&expyear=&tcardno=515621XXXXXX9193&time=1624351278&cardid=4&currency=208&ccrg=6640.9366.6531\"}'),
('2021-06-22 08:41:18', 'Uk8Pdy1vUvICjqLu3KdmRAez7L5HNd8z.ntjr9ylT1YE', 2005165368, 'STL20210622104107336941', 'AUTH', '<requestblock version=\"3.67\">\n    <alias>WebserviceYourpay</alias>\n    <request type=\"AUTH\">\n        <operation>\n            <sitereference>yourpay83253</sitereference>\n            <accounttypedescription>ECOM</accounttypedescription>\n            <authmethod>PRE</authmethod>  \n        </operation>\n        <threedsecure><cavv>kBMRcIzj2jD11ABkYHQVgyCBATM9</cavv><eci>02</eci><enrolled>Y</enrolled><status>Y</status><version>2.1.0</version><directorytransactionreference>62c3f9cd-60b3-4d91-9cc2-744de30f6152</directorytransactionreference></threedsecure>\n        <merchant>\n            <submerchantid>00014060004772</submerchantid>\n            <merchantstreet>Valhoejs Alle 158</merchantstreet>\n            <merchantcity>Roedovre</merchantcity>\n            <merchantstatecode></merchantstatecode>\n            <merchantzipcode>Valhoe</merchantzipcode>\n            <merchantcountryiso2a>DK</merchantcountryiso2a>\n            <orderreference>2005165368</orderreference>\n            <chargedescription>Yourpay</chargedescription>\n            <termurl>https//webservice.yourpay.dk/v4.3/0_async_3ds.php</termurl>        \n        </merchant>\n        <customer>\n            <accept></accept>\n            <useragent></useragent>\n        </customer>\n        <billing>\n            <amount currencycode=\"DKK\">100</amount>\n            <payment type=\"MASTERCARD\">\n                <expirydate>05/24</expirydate>\n                <pan>5156219004199193</pan>\n                \n            </payment>\n        </billing>\n        <settlement>\n            <settlestatus>2</settlestatus>\n        </settlement>\n    </request>\n</requestblock>', '{\"@attributes\":{\"version\":\"3.67\"},\"requestreference\":\"W57-k9hxua0g\",\"response\":{\"@attributes\":{\"type\":\"AUTH\"},\"acquirerresponsecode\":\"00\",\"acquirerresponsemessage\":\"Approved or completed Successfully\",\"authcode\":\"104117\",\"billing\":{\"amount\":\"100\",\"dcc\":{\"@attributes\":{\"enabled\":\"0\"}},\"payment\":{\"@attributes\":{\"type\":\"MASTERCARD\"},\"issuer\":\"BOKIS\",\"issuercountry\":\"DK\",\"pan\":\"515621######9193\"}},\"error\":{\"code\":\"0\",\"message\":\"Ok\"},\"live\":\"1\",\"merchant\":{\"chargedescription\":\"Yourpay\",\"facilitatorid\":\"229186\",\"facilitatorname\":\"YourPay\",\"merchantcategorycode\":\"5039\",\"merchantcity\":\"Roedovre\",\"merchantcountryiso2a\":\"DK\",\"merchantname\":\"YourPay\",\"merchantnumber\":\"000104960044266\",\"merchantzipcode\":\"Valhoe\",\"operatorname\":\"WebserviceYourpay\",\"orderreference\":\"2005165368\",\"submerchantid\":\"00014060004772\"},\"operation\":{\"accounttypedescription\":\"ECOM\",\"authmethod\":\"PRE\",\"parenttransactionreference\":\"57-92-8368493\",\"splitfinalnumber\":\"1\"},\"other\":{\"retrievalreferencenumber\":\"117308577713\",\"stan\":\"577713\"},\"security\":{\"address\":\"0\",\"postcode\":\"0\",\"securitycode\":\"0\"},\"settlement\":{\"settleduedate\":\"2021-06-22\",\"settlestatus\":\"2\"},\"threedsecure\":{\"cavv\":\"kBMRcIzj2jD11ABkYHQVgyCBATM9\",\"eci\":\"02\",\"enrolled\":\"Y\",\"status\":\"Y\",\"version\":\"2.1.0\"},\"timestamp\":\"2021-06-22 08:41:07\",\"transactionreference\":\"57-70-14867713\"},\"secrand\":\"AQmhm\"}'),
('2021-06-22 08:41:03', 'Uk8Pdy1vUvICjqLu3KdmRAez7L5HNd8z.ntjr9ylT1YE', 2005165368, 'THREED_CONFIRM_REQ20210622104103753061', 'THREEDCONFIRM', '', '{\"token\":\"Uk8Pdy1vUvICjqLu3KdmRAez7L5HNd8z.ntjr9ylT1YE\",\"complete\":\"1\",\"3ds_trxid\":\"f071c2eb-b899-42af-8acf-6b65d7bdfbc8\",\"3ds_valid_payment\":\"Y\",\"3ds_cavv\":\"kBMRcIzj2jD11ABkYHQVgyCBATM9\",\"K\":\"4cd767360f42434b64df5c61a46f081f\",\"3ds_eci\":\"02\",\"3ds_status\":\"Y\",\"O\":\"98\",\"a1\":\"60004772CRD20210622103952173278\",\"z1\":\"XZZ664277c682fe730956DMDJ6WINHP5\",\"z2\":\"0\",\"3ds_version\":\"2.1.0\",\"z3\":\"Transaction has been executed successfully.\",\"3ds_dstrxid\":\"62c3f9cd-60b3-4d91-9cc2-744de30f6152\",\"z55\":\"XZZ664277c682fe7309G3HAITO4BBCNL\"}');

INSERT INTO `02_payments` (`PaymentID`, `processing_platform`, `pay_method`, `pos_trans`, `merchantnumber`, `testtrans`, `ct`, `bankinglist`, `orderID`, `TransID`, `Currency`, `transfee`, `transfeeyp`, `amount`, `reserved_amount`, `reserve_payout`, `transferedtoreserve`, `cardtype`, `cardholder`, `card_country`, `cardno`, `cardnoprefix`, `restimestamp`, `accountid`, `dateid`, `bkreg`, `bkacc`, `secure`, `approved`, `ended`, `end_time`, `notification`, `notification_email`, `callback`, `callback_time`, `callback_ip`, `callback_header`, `req_capture`, `req_capture_time`, `transactionfile`, `split`, `mass_capture`, `mass_refund`, `mass_delete`, `req_amount`, `epay_capture`, `epay_capture_timestamp`, `req_delete`, `req_delete_time`, `req_delete_epay`, `req_refund`, `req_refund_amount`, `req_refund_time`, `req_refund_epay`, `req_refund_epay_time`, `req_refund_date_offsetting`, `req_refund_paymentcapture`, `platform`, `platform_domain`, `version`, `customerdetails`, `customer_ip`, `fraud`, `paymentplatform`, `channelID`, `uniqueid`, `shortid`, `shortid_ccrg`, `ccrg_trans`, `capture_shortid`, `capture_uniqueid`, `free_transaction`, `upd_check`, `pbs_forretningsid`, `chainedpayment`, `chainedPaymentID`, `ChainedAmount`, `payment_institute`, `payon_channel`, `payon_sender`, `payon_login`, `payon_pwd`, `consumer_data_validated`, `connected_subscriptioncode`, `connected_chained`, `last_updated`) VALUES
(3947467, 'stl', 'card', 0, 60004772, 0, 0, 0, 'CCRG', '2005165368', '208', '0', 0, '100', 0, 0, 0, '4', '', 208, '515621XXXXXX9193', 9193, '1624351278', 0, 0, 0, '0', 0, 1, 0, 0, '', '', '', '', '', '', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, '', '', '109', '', 0x30, '0', 0, 0, 'W57-k9hxua0g', '57-70-14867713', '6640.9366.6531', 0, '', '', 0, 0, 0, 0, '', 0, 30, NULL, '', '', '', 0, '', '', '2021-06-22 08:42:17');

INSERT INTO `02_rebilling` (`RebillingID`, `original_orderid`, `testtrans`, `schedule`, `short_id`, `unique_id`, `mask`, `webservice_id`, `masked_shortid`, `masked_uniqueID`, `customer_name`, `merchantid`, `period_days`, `period_dayinmonth`, `period_price`, `period_currency`, `period_start`, `period_next_schedule`, `period_left`, `times_happend`, `activated`, `period_capture`, `callbackurl`, `rebilling_rb`, `rebilling_rb_identification`, `last_capture_response`, `rebilling_failures`, `verified`, `lastused`, `lastMerchantID`, `last_updated`) VALUES
(687808, 'CCRG', 0, 0, '6640.9366.6531', 'W57-k9hxua0g', 0, 0, '', '', '', '60004772', '', '', '', '', '0', 0, 0, 0, 1, '0', '', 0, '', '', 0, 0, 0, NULL, '0000-00-00 00:00:00');